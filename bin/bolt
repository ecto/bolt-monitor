#!/usr/bin/env node

var parser  = require('nomnom'),
    forever = require('forever'),
    colors  = require('colors');

parser.command('start')
   .callback(start)
   .help("start the bolt server");

parser.command('stop')
   .callback(stop)
   .help("stop the bolt server");

parser.parseArgs();

function start(){
  if (process.env.USER != 'root') {
    console.log('I refuse to run without permission, good sir!'.red);
    console.log('Try: ' + 'sudo !!'.green);
  } else {
    console.log('Starting bolt-server...'.magenta);
    var file = __dirname + '/../mesh.js';
    forever.list(null, function(err, procs){
      var running = false;
      if (procs) {
        for (var i in procs) {
          if (procs[i].file == file) {
            running = true;
            break;
          }
        }
      }
      if (!running) {
        forever.cli.start(file, {}, true);
        console.log('Done!'.green);
      } else console.log('Bolt is already running! I disincline to acquiesce to your request.'.red);
    });
  }
}

function stop(){
  if (process.env.USER != 'root') {
    console.log('I refuse to run without permission, good sir!'.red);
    console.log('Try: ' + 'sudo !!'.green);
  } else {
    console.log('Stopping bolt-server...'.magenta);
    var file = __dirname + '/../mesh.js';
    forever.cli.stop(file);
    console.log('Done!'.green);
  }
}
